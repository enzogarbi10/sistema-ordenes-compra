{% extends 'web/base.html' %}
{% load static %}

{% block title %}Nuestra Tecnología - Gráfica Melfa{% endblock %}

{% block extra_head %}
<style>
    html {
        scroll-behavior: smooth;
    }

    .sub-navbar {
        position: sticky;
        top: 70px;
        background: #1a1a1a;
        /* Dark tech aesthetic */
        z-index: 1000;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        transition: top 0.3s ease;
    }

    .sub-nav-link {
        color: rgba(255, 255, 255, 0.7);
        text-decoration: none;
        padding: 15px 25px;
        font-size: 0.8rem;
        letter-spacing: 2px;
        text-transform: uppercase;
        font-weight: 600;
        transition: all 0.3s;
        border-bottom: 2px solid transparent;
    }

    .sub-nav-link:hover,
    .sub-nav-link.active {
        color: var(--accent-orange);
        background: rgba(255, 255, 255, 0.05);
        border-bottom: 2px solid var(--accent-orange);
    }

    .showcase-block {
        min-height: 100vh;
        display: flex;
        align-items: center;
        position: relative;
        padding: 120px 0;
        overflow: hidden;
    }

    /* Default showcase background if none provided */
    .showcase-block {
        background: radial-gradient(circle at 50% 50%, #1a1a1a, #000000);
        min-height: 100vh;
        display: flex;
        align-items: center;
        position: relative;
        padding: 150px 0;
        overflow: hidden;
    }

    /* Sumatik Style - Diagonal Cuts */
    .corte-inclinado-derecha {
        clip-path: polygon(0 0, 100% 0, 100% 92%, 0 100%);
        margin-bottom: -8%;
        z-index: 1;
    }

    .corte-inclinado-izquierda {
        clip-path: polygon(0 8%, 100% 0, 100% 100%, 0 100%);
        padding-top: 180px;
        z-index: 2;
    }

    .texture-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: url('data:image/svg+xml;utf8,<svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><filter id="noiseFilter"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="3" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23noiseFilter)" opacity="0.03"/></svg>');
        pointer-events: none;
        z-index: 1;
    }

    .showcase-content {
        position: relative;
        z-index: 2;
    }

    .line-title {
        font-size: 4rem;
        line-height: 1.1;
        margin-bottom: 1.5rem;
        font-weight: 700;
        letter-spacing: -1px;
    }

    .line-subtitle {
        color: var(--accent-orange);
        text-transform: uppercase;
        letter-spacing: 4px;
        font-weight: 600;
        font-size: 0.9rem;
        display: block;
        margin-bottom: 1rem;
    }

    .line-description {
        font-size: 1.25rem;
        color: #cccccc;
        font-weight: 300;
        line-height: 1.6;
        margin-bottom: 2.5rem;
        max-width: 600px;
    }

    .product-display {
        position: relative;
        height: 500px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .product-img {
        max-height: 100%;
        max-width: 100%;
        object-fit: cover;
        box-shadow: 0 30px 40px rgba(0, 0, 0, 0.8);
        transition: transform 0.6s cubic-bezier(0.165, 0.84, 0.44, 1);
        border-radius: 4px;
        border: 1px solid #333;
    }

    .product-img:hover {
        transform: scale(1.03);
    }

    .varietal-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
    }

    .tag-box {
        background: transparent;
        color: #d1d1d1;
        border: 1px solid rgba(255, 102, 0, 0.3);
        padding: 12px 24px;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: all 0.3s;
        font-family: 'Montserrat', sans-serif;
    }

    .tag-box:hover {
        background: rgba(255, 102, 0, 0.1);
        border-color: var(--accent-orange);
        color: #fff;
    }

    .samples-hero {
        padding-top: 180px;
        padding-bottom: 80px;
        background: #000;
        text-align: center;
    }

    @media (max-width: 768px) {
        .line-title {
            font-size: 3rem;
        }

        .product-display {
            height: 350px;
            margin-bottom: 40px;
        }

        .sub-nav-link {
            padding: 10px 15px;
            font-size: 0.75rem;
        }
    }
</style>
{% endblock %}

{% block content %}

<!-- Intro Header -->
<section class="samples-hero">
    <div class="container">
        <span class="line-subtitle" data-aos="fade-down">Vanguardia Industrial</span>
        <h1 class="serif display-2 fw-bold text-white mb-4" data-aos="fade-up">Nuestra Tecnología</h1>
        <p class="lead text-muted mx-auto" style="max-width: 700px;" data-aos="fade-up" data-aos-delay="100">
            Contamos con maquinaria de última generación para asegurar una producción ágil, precisa e impecable. La
            tecnología flexográfica más avanzada a disposición de su marca.
        </p>
    </div>
</section>

<!-- Sub Navigation -->
<nav class="sub-navbar" id="subNavbar">
    {% for tec in tecnologias %}
    <a href="#{{ tec.nombre_clave }}" class="sub-nav-link">{{ tec.titulo|truncatechars:20 }}</a>
    {% endfor %}
</nav>

{% for tec in tecnologias %}
<!-- Section: {{ tec.titulo }} -->
<section id="{{ tec.nombre_clave }}"
    class="showcase-block {% if forloop.counter0|divisibleby:2 %}corte-inclinado-derecha{% else %}corte-inclinado-izquierda{% endif %}"
    style="{% if tec.fondo_css %}background: {{ tec.fondo_css|safe }};{% endif %}">
    <div class="texture-overlay"></div>
    <div class="container showcase-content">
        <div
            class="row align-items-center {% if forloop.counter0|divisibleby:2 %}flex-column-reverse flex-lg-row{% endif %}">

            {% if forloop.counter0|divisibleby:2 %}
            <div class="col-lg-5" data-aos="fade-right">
                <span class="line-subtitle">{{ tec.subtitulo }}</span>
                <h2 class="serif line-title text-white">{{ tec.titulo|safe }}</h2>
                <p class="line-description">
                    {{ tec.descripcion }}
                </p>
                <div class="varietal-tags">
                    {% for tag in tec.get_etiquetas_list %}
                    <div class="tag-box">{{ tag }}</div>
                    {% endfor %}
                </div>
            </div>
            <div class="col-lg-7" data-aos="fade-left">
                <div class="product-display">
                    <img src="{% if tec.imagen %}{{ tec.imagen.url }}{% endif %}" class="product-img"
                        alt="{{ tec.titulo }}">
                </div>
            </div>

            {% else %}

            <div class="col-lg-7 mb-5 mb-lg-0" data-aos="fade-right">
                <div class="product-display">
                    <img src="{% if tec.imagen %}{{ tec.imagen.url }}{% endif %}" class="product-img"
                        alt="{{ tec.titulo }}">
                </div>
            </div>
            <div class="col-lg-5" data-aos="fade-left">
                <span class="line-subtitle">{{ tec.subtitulo }}</span>
                <h2 class="serif line-title text-white">{{ tec.titulo|safe }}</h2>
                <p class="line-description">
                    {{ tec.descripcion }}
                </p>
                <div class="varietal-tags">
                    {% for tag in tec.get_etiquetas_list %}
                    <div class="tag-box">{{ tag }}</div>
                    {% endfor %}
                </div>
            </div>

            {% endif %}

        </div>
    </div>
</section>
{% endfor %}

{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<script>
    AOS.init({ duration: 1000, once: true, offset: 100 });
    window.addEventListener('scroll', function () {
        const mainNav = document.querySelector('.navbar');
        const subNav = document.getElementById('subNavbar');
        if (window.scrollY > 50) {
            mainNav.style.backgroundColor = 'rgba(0, 0, 0, 0.98)';
            subNav.style.top = mainNav.offsetHeight + 'px';
        } else {
            mainNav.style.backgroundColor = 'rgba(0, 0, 0, 0.95)';
            subNav.style.top = '70px';
        }
    });

    const sections = document.querySelectorAll('.showcase-block');
    const navLinks = document.querySelectorAll('.sub-nav-link');

    window.addEventListener('scroll', () => {
        let current = '';
        sections.forEach(section => {
            if (scrollY >= (section.offsetTop - 200)) {
                current = section.getAttribute('id');
            }
        });
        navLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href').includes(current)) {
                link.classList.add('active');
            }
        });
    });
</script>
{% endblock %}